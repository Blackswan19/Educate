<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>BsBookpad - Download</title> <link rel="icon" type="image/x-icon" href="https://i.ibb.co/s2hfQSZ/bokpad.png"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script> <style> @import url('https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&family=Orbitron:wght@400..900&family=Red+Hat+Display:ital,wght@0,300..900;1,300..900&family=Strait&display=swap'); /* General Styles */ * { color: rgb(219, 219, 219); box-sizing: border-box; } ::-webkit-scrollbar { width: 8px; height: 8px; } ::-webkit-scrollbar-thumb { background-color: #4a4a4a; border-radius: 0px; cursor: pointer; width: 120px; } ::-webkit-scrollbar-thumb:hover { background-color: #8f8f8f; } ::-webkit-scrollbar-track { background-color: #2e2e2e; bottom: 0px; } * { -webkit-tap-highlight-color: transparent; } body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } body, html { margin: 0; padding: 0; width: 100%; height: 95%; display: flex; justify-content: center; align-items: center; background-color: #121212; position: fixed; font-family: "Red Hat Display", sans-serif; letter-spacing: 0.6px; } /* Logo and Container Styles */ .logo { position: fixed; top: 31px; left: 40px; font-size: 24px; color: #004cff; font-weight: 600; text-decoration: none; } .fullscreen-container { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%; padding: 60px; z-index: -100; } /* Editable Div Styles */ .editable-div { width: 80%; height: 450px; padding: 30px; font-size: 16px; background-color: rgb(55 55 55); color: #c6c6c6; border-radius: 30px; border: solid 1.5px rgb(255 255 255 / 0%); outline: none; font-family: "Red Hat Display", sans-serif; letter-spacing: 0.5px; font-weight: 500; transition: font-size 0.3s ease, background-color 0.3s ease, color 0.3s ease; overflow-y: auto; white-space: pre-wrap; margin-bottom: 20px; position: relative; top: 30px; display: flow; line-height: 1.5; } .editable-div:empty:before { content: attr(data-placeholder); color: var(--placeholder-color, #c6c6c6); pointer-events: none; } .editable-div:focus { background-color: #3a3a3a8d; } .editable-div::-webkit-scrollbar-track { background: transparent; margin-left: 35px; margin-right: 35px; margin-top: 35px; margin-bottom: 35px; } /* Icon Buttons Styles */ .icon-buttons { display: flex; gap: 20px; position: fixed; bottom: 20px; padding: 20px; border-radius: 15px; } .icon-buttons i { font-size: 20px; padding: 10px 20px; border-radius: 10px; cursor: pointer; transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease; } .delete-icon { background-color: #ff0d00; color: white; } .copy-single-icon { background-color: #00e208c1; color: white; } .uppercase-icon { background-color: #bc00ff; color: white; } .download-image-icon { background-color: #ff0056; color: white; } .download-pdf-icon { background-color: #008eff; color: white; } .save-icon { background-color: #00c4b4; color: white; } .sidebar-icon { background-color: #ff9500; color: white; } .delete-icon:hover { background-color: #ff0d00c3; } .copy-single-icon:hover { background-color: #00e20882; } .uppercase-icon:hover { background-color: #bb00ffca; } .download-image-icon:hover { background-color: #ff0056b0; } .download-pdf-icon:hover { background-color: #008cffb9; } .save-icon:hover { background-color: #00c4b4b9; } .sidebar-icon:hover { background-color: #ff9500b9; } .icon-buttons i:hover { transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); } /* Color Picker and Font Controls */ .color-picker-container { position: fixed; bottom: 25px; right: 175px; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; background: #2b2b2b; padding: 10px; border-radius: 13px; } .color-picker-label { font-size: 14px; color: #c6c6c6; } .color-picker { width: 40px; height: 40px; border: none; background: transparent; cursor: pointer; padding: 0; border-radius: 5px; } .font-size-container { position: fixed; bottom: 25px; left: 175px; display: flex; align-items: center; gap: 10px; background: #2b2b2b; padding: 15px; border-radius: 13px; justify-content: center; flex-direction: column; width: 13%; } .font-weight-container { position: fixed; bottom: 70px; right: 10px; display: flex; align-items: center; gap: 10px; background: #2b2b2b; padding: 10px; border-radius: 13px; } .font-size-label, .font-weight-label { font-size: 14px; color: #c6c6c6; } .font-size-button, .font-weight-select { background-color: #1b1b1b; color: #c6c6c6; border: 1px solid #3a3a3a; border-radius: 5px; padding: 5px; font-family: "Red Hat Display", sans-serif; cursor: pointer; } /* Message and Watermark */ .message { margin-top: 10px; color: rgb(255, 255, 255); text-align: center; position: fixed; top: 30px; font-weight: 400; padding: 10px 20px; z-index: 10000000; background: #2f2f2f; border-radius: 9px; border: none; right: 45px; } .watermark { position: absolute; top: 5px; left: 5px; font-size: 8px; opacity: 0.9; font-family: "Red Hat Display", sans-serif; } .watermark a { color: inherit; text-decoration: none; } .text-content { white-space: pre-wrap; line-height: 1.5; margin: 0; padding: 0; } /* Sidebar Styles */ .sidebar { position: fixed; bottom: 0; right: -550px; width: 450px; height: 85%; background: rgb(27 27 27); backdrop-filter: blur(10px); box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3); z-index: 1000; transition: right 0.3s ease; padding: 20px; overflow-y: auto; border-left: 1px solid rgba(255, 255, 255, 0.1); border-radius: 28px 0px 0px 0px; } .sidebar.open { right: 0; } .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); } .sidebar-title { font-size: 20px; color: #ffffff; font-weight: 600; } .close-sidebar { font-size: 20px; color: #c6c6c6; cursor: pointer; transition: color 0.3s ease; } .close-sidebar:hover { color: #ffffff; } .save-form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; } .save-form input { padding: 10px; background: #1b1b1b; border: 1px solid #3a3a3a; border-radius: 5px; color: #c6c6c6; font-family: "Red Hat Display", sans-serif; outline: none; } .save-form button { padding: 10px; background: #004cff; border: none; border-radius: 5px; color: white; font-family: "Red Hat Display", sans-serif; cursor: pointer; transition: background 0.3s ease; } .save-form button:hover { background: #002cff; } .saved-item { margin-bottom: 15px; padding: 10px; border-radius: 8px; transition: background 0.3s ease; } .saved-item:hover { background: #2b2b2b; } .saved-item-title { font-size: 16px; color: #00c4b4; font-weight: 600; cursor: pointer; margin-bottom: 5px; display: flex; gap: 5px; align-items: baseline; } .saved-item-title:hover { text-decoration: underline; } .saved-item-content { font-size: 11px; color: #c6c6c6; display: none; padding: 10px; background: rgb(27 27 27); border-radius: 5px; overflow: auto; } .saved-item-content.show { display: block; } .saved-item-content.show:hover{ font-size: 15px; } .copy-item, .delete-item { font-size: 11px; cursor: pointer; margin-top: 9px; transition: color 0.3s ease; padding: 6px 14px; border-radius: 8px; text-align: center; font-weight: 600; } .copy-item { color: #00ff6c; background: #0eff0026; } .copy-item:hover { color: black; background: #00e208; } .delete-item { color: #ff2e22; background: #480400a1; font-weight: 600; } .delete-item:hover { background-color: #ff0d00; color: white; } .saved-item-actions { display: flex; gap: 10px; justify-content: flex-start; } /* Responsive Design */ @media (max-width: 768px) { .fullscreen-container { padding: 40px; } .editable-div { height: 35%; padding: 15px; font-size: 1rem; } .icon-buttons i { font-size: 0.9rem; padding: 8px 16px; } .message { font-size: 1rem; } .color-picker-container { bottom: 70px; right: 20px; } .color-picker-label { font-size: 12px; } .color-picker { width: 30px; height: 30px; } .font-size-container { bottom: 80px; left: 5px; width: 40%; } .font-weight-container { bottom: 170px; right: 20px; } .font-size-label, .font-weight-label { font-size: 12px; } .font-size-button, .font-weight-select { font-size: 12px; } .sidebar { width: 280px; right: -580px;height: 91%; } .sidebar-title { font-size: 18px; } .save-form input, .save-form button { font-size: 14px; } } @media (max-width: 480px) { .fullscreen-container { padding: 20px; } .editable-div { height: 50%; padding: 30px; font-size: 14px; width: 95%; position: fixed; top: 100px; } .icon-buttons i { font-size: 15px; } .icon-buttons { gap: 9px; position: fixed; bottom: 10px; } .message { font-size: 13px; top: 0px; right: 10px; } .logo { position: fixed; top: 10px; left: 10px; font-size: 18px; } .color-picker-container { bottom: 80px; right: 5px; background: #2b2b2b; padding: 10px; border-radius: 13px; } .color-picker-label { font-size: 11px; } .color-picker { width: 25px; height: 25px; } .font-size-container { bottom: 80px; padding: 10px; left: 5px; width: 40%; } .font-weight-container { bottom: 180px; right: 5px; } .font-size-label, .font-weight-label { font-size: 11px; } .font-size-button, .font-weight-select { font-size: 11px; } .sidebar { width: 300px; right: -540px; } .sidebar-title { font-size: 16px; } .save-form input, .save-form button { font-size: 12px; } } </style> </head> <body> <div class="logo">BsBookpad <i style="background: #2b2b2b; padding: 10px; margin-left: 2px; border-radius: 11px; align-items: center; font-size: 15px;" class="fa-solid fa-cloud-arrow-down"></i></div> <div class="fullscreen-container"> <div id="paragraphInput" class="editable-div" contenteditable="true" data-placeholder="Type your paragraph..."></div> <div class="icon-buttons"> <i class="fa-solid fa-arrow-up-a-z uppercase-icon" onclick="toggleCase()" title="Toggle Case"></i> <i class="fa-solid fa-text-slash delete-icon" onclick="newInput()" title="Clear Field"></i> <i class="fa-regular fa-copy copy-single-icon" onclick="copySingleLine()" title="Copy Text"></i> <i class="fa-solid fa-image download-image-icon" onclick="downloadAsImage()" title="Download as Image"></i> <i class="fa-solid fa-file-pdf download-pdf-icon" onclick="downloadAsPDF()" title="Download as PDF"></i> <i class="fa-solid fa-clock-rotate-left sidebar-icon" onclick="toggleSidebar()" title="Open Saved Items"></i> </div> <div class="message" id="message"><a href="https://blackswan19.github.io/bscrop/formbs" style="text-decoration: none;">#BsWorld</a></div> <div class="color-picker-container"> <div> <span class="color-picker-label">Image Background:</span> <input type="color" id="imageBackgroundColor" class="color-picker" value="#1b1b1b" title="Select Image Background Color"> </div> <div> <span class="color-picker-label">Image Text:</span> <input type="color" id="imageTextColor" class="color-picker" value="#c6c6c6" title="Select Image Text Color"> </div> </div> <div class="font-size-container"> <button id="fontSizeButton" class="font-size-button" onclick="promptFontSize()">Change Font Size</button> <span class="font-weight-label">Font Weight:</span> <select id="fontWeightSelect" class="font-weight-select" title="Select Font Weight"> <option value="100">100</option> <option value="200">200</option> <option value="300">300</option> <option value="400" selected>400</option> <option value="500">500</option> <option value="600">600</option> <option value="700">700</option> <option value="800">800</option> <option value="900">900</option> </select> </div> <div class="sidebar" id="sidebar"> <div class="sidebar-header"> <span class="sidebar-title">Saved Items</span> <i class="fa-solid fa-times close-sidebar" onclick="toggleSidebar()"></i> </div> <div class="save-form"> <input type="text" id="saveTitle" placeholder="Enter content title to save..." /> <button onclick="saveWithTitle()">Save Content</button> </div> <div id="savedItems"></div> </div> </div>
      <script>
         // Initialize editable div with default styles
         const editableDiv = document.getElementById('paragraphInput');
         editableDiv.style.fontSize = '16px';
         editableDiv.style.fontWeight = '400';
         editableDiv.style.color = '#c6c6c6';

         // Load saved data on page load
         document.addEventListener('DOMContentLoaded', () => {
            const savedData = JSON.parse(localStorage.getItem('bsBookpadData') || '{}');
            if (savedData.text) {
               editableDiv.innerHTML = savedData.text;
            }
            if (savedData.backgroundColor) {
               editableDiv.style.backgroundColor = savedData.backgroundColor;
               document.getElementById('imageBackgroundColor').value = savedData.backgroundColor;
            }
            if (savedData.textColor) {
               applyTextColor(savedData.textColor);
               document.getElementById('imageTextColor').value = savedData.textColor;
            }
            if (savedData.fontSize) {
               editableDiv.style.fontSize = `${savedData.fontSize}px`;
            }
            if (savedData.fontWeight) {
               editableDiv.style.fontWeight = savedData.fontWeight;
               document.getElementById('fontWeightSelect').value = savedData.fontWeight;
            }
            loadSavedItems();
         });

         // Function to apply text color to all child elements
         function applyTextColor(color) {
            editableDiv.style.color = color;
            editableDiv.style.setProperty('--placeholder-color', color);
            const allElements = editableDiv.querySelectorAll('*');
            allElements.forEach(element => {
               element.style.color = color;
            });
         }

         // Save input function
         function saveInput(showMessage = true) {
            const data = {
               text: editableDiv.innerHTML,
               backgroundColor: document.getElementById('imageBackgroundColor').value,
               textColor: document.getElementById('imageTextColor').value,
               fontSize: editableDiv.style.fontSize.replace('px', ''),
               fontWeight: document.getElementById('fontWeightSelect').value
            };
            localStorage.setItem('bsBookpadData', JSON.stringify(data));
            if (showMessage) {
               displayMessage('Input saved!');
            }
         }

         // Save with title
         function saveWithTitle() {
            const text = editableDiv.innerText.trim();
            const title = document.getElementById('saveTitle').value.trim();
            if (!text) {
               displayMessage("Nothing to save..!");
               return;
            }
            if (!title) {
               displayMessage("Title cannot be empty!");
               return;
            }
            const savedItems = JSON.parse(localStorage.getItem('savedItems') || '[]');
            savedItems.push({ title, content: text });
            localStorage.setItem('savedItems', JSON.stringify(savedItems));
            document.getElementById('saveTitle').value = '';
            displayMessage(`Saved as "${title}"!`);
            loadSavedItems();
         }

         // Load saved items into sidebar
         function loadSavedItems() {
            const savedItems = JSON.parse(localStorage.getItem('savedItems') || '[]');
            const savedItemsContainer = document.getElementById('savedItems');
            savedItemsContainer.innerHTML = '';
            savedItems.forEach((item, index) => {
               const itemDiv = document.createElement('div');
               itemDiv.className = 'saved-item';
               itemDiv.innerHTML = `
                  <div class="saved-item-title" onclick="toggleContent(${index})">${item.title} <span style="font-size: 8px;font-weight:200">[click to view content]</span></div>
                  <div class="saved-item-content" id="content-${index}">${item.content}</div>
                  <div class="saved-item-actions">
                     <div class="copy-item" onclick="copyItem(${index})">Copy Content</div>
                     <div class="delete-item" onclick="deleteItem(${index})">Delete Item</div>
                  </div>
               `;
               savedItemsContainer.appendChild(itemDiv);
            });
         }

         // Toggle content visibility
         function toggleContent(index) {
            const contentDiv = document.getElementById(`content-${index}`);
            contentDiv.classList.toggle('show');
         }

         // Copy specific item content
         function copyItem(index) {
            const savedItems = JSON.parse(localStorage.getItem('savedItems') || '[]');
            const text = savedItems[index].content;
            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = text;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
            displayMessage(`Copied "${savedItems[index].title}" content!`);
         }

         // Delete specific item
         function deleteItem(index) {
            const savedItems = JSON.parse(localStorage.getItem('savedItems') || '[]');
            const itemTitle = savedItems[index].title;
            savedItems.splice(index, 1);
            localStorage.setItem('savedItems', JSON.stringify(savedItems));
            loadSavedItems();
            displayMessage(`Deleted "${itemTitle}"!`);
         }

         // Toggle sidebar
         function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
         }

         // Auto-save on text input
         editableDiv.addEventListener('input', () => {
            saveInput(false);
         });

         // Auto-save on color changes
         document.getElementById('imageBackgroundColor').addEventListener('input', function() {
            editableDiv.style.backgroundColor = this.value;
            saveInput(false);
         });

         document.getElementById('imageTextColor').addEventListener('input', function() {
            applyTextColor(this.value);
            saveInput(false);
         });

         // Handle paste event to clean styles and apply current text color and font weight
         editableDiv.addEventListener('paste', function(e) {
            e.preventDefault();
            const text = (e.clipboardData || window.clipboardData).getData('text/plain');
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text.replace(/<[^>]+>/g, '');
            const cleanText = tempDiv.innerText;
            const currentColor = document.getElementById('imageTextColor').value;
            const currentFontWeight = document.getElementById('fontWeightSelect').value;

            const span = document.createElement('span');
            span.style.color = currentColor;
            span.style.fontWeight = currentFontWeight;
            span.textContent = cleanText;
            document.execCommand('insertHTML', false, span.outerHTML);

            applyTextColor(currentColor);
            const allSpans = editableDiv.querySelectorAll('span');
            allSpans.forEach(span => {
               span.style.fontWeight = currentFontWeight;
            });
            saveInput(false);
         });

         // Prompt for font size
         function promptFontSize() {
            const fontSize = prompt('Enter font size in pixels (e.g., 16):', editableDiv.style.fontSize.replace('px', '') || '16');
            if (fontSize && !isNaN(fontSize) && fontSize > 0) {
               editableDiv.style.fontSize = `${fontSize}px`;
               saveInput(false);
               displayMessage(`Font size set to ${fontSize}px!`);
            } else {
               displayMessage('Invalid font size!');
            }
         }

         // Sync font weight with selector and auto-save
         document.getElementById('fontWeightSelect').addEventListener('change', function() {
            const fontWeight = this.value;
            const selection = window.getSelection();

            if (selection.rangeCount > 0 && selection.toString().trim() !== '') {
               const range = selection.getRangeAt(0);
               const selectedText = range.toString();
               if (selectedText) {
                  const span = document.createElement('span');
                  span.style.fontWeight = fontWeight;
                  span.style.color = document.getElementById('imageTextColor').value;
                  span.textContent = selectedText;
                  range.deleteContents();
                  range.insertNode(span);
                  selection.removeAllRanges();
                  displayMessage(`Font weight ${fontWeight} applied to selection!`);
               }
            } else {
               editableDiv.style.fontWeight = fontWeight;
               const allSpans = editableDiv.querySelectorAll('span');
               allSpans.forEach(span => {
                  span.style.fontWeight = fontWeight;
               });
               displayMessage(`Font weight ${fontWeight} applied globally!`);
            }
            saveInput(false);
         });

         // Function to calculate luminance for a hex color
         function getLuminance(hex) {
            const r = parseInt(hex.substring(1, 3), 16) / 255;
            const g = parseInt(hex.substring(3, 5), 16) / 255;
            const b = parseInt(hex.substring(5, 7), 16) / 255;
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
         }

         // Function to get contrasting color based on background luminance
         function getContrastColor(hex) {
            const luminance = getLuminance(hex);
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
         }

         function newInput() {
            editableDiv.innerHTML = '';
            localStorage.removeItem('bsBookpadData');
            displayMessage("Cleared and saved data removed!");
         }

         function copySingleLine() {
            const text = editableDiv.innerText.trim();
            if (text === "") {
               displayMessage("Nothing to copy..!");
               return;
            }

            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = text;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
    
            displayMessage("Copied..!");
         }
    
         let isUpperCase = false;
         function toggleCase() {
            const text = editableDiv.innerText.trim();
            if (text === "") {
               displayMessage("Enter text first..!");
               return;
            }
            
            if (!isUpperCase) {
               editableDiv.innerText = text.toUpperCase();
               displayMessage("Uppercase..!");
            } else {
               editableDiv.innerText = text.toLowerCase();
               displayMessage("Lowercase..!");
            }
            isUpperCase = !isUpperCase;
            saveInput(false);
         }

         function downloadAsImage() {
            if (!editableDiv.innerText.trim()) {
               displayMessage("Nothing to download..!");
               return;
            }

            const backgroundColor = document.getElementById('imageBackgroundColor').value;
            const textColor = document.getElementById('imageTextColor').value;
            const fontSize = editableDiv.style.fontSize || '16px';
            const fontWeight = editableDiv.style.fontWeight || '400';

            // Create a wrapper for the content
            const wrapper = document.createElement('div');
            wrapper.style.position = 'absolute';
            wrapper.style.left = '-9999px';
            wrapper.style.backgroundColor = backgroundColor;
            wrapper.style.padding = '20px';
            wrapper.style.boxSizing = 'border-box';
            wrapper.style.fontFamily = '"Red Hat Display", sans-serif';
            wrapper.style.letterSpacing = '0.5px';
            wrapper.style.lineHeight = '1.5';
            wrapper.style.whiteSpace = 'pre-wrap';

            // Clone the editable div
            const clonedDiv = editableDiv.cloneNode(true);
            clonedDiv.style.width = editableDiv.offsetWidth + 'px';
            clonedDiv.style.height = 'auto';
            clonedDiv.style.maxWidth = '800px';
            clonedDiv.style.overflow = 'visible';
            clonedDiv.style.border = 'none';
            clonedDiv.style.margin = '0';
            clonedDiv.style.padding = '20px';
            clonedDiv.style.backgroundColor = backgroundColor;
            clonedDiv.style.fontSize = fontSize;
            clonedDiv.style.fontWeight = fontWeight;
            clonedDiv.style.color = textColor;
            clonedDiv.style.position = 'static';
            clonedDiv.removeAttribute('contenteditable');
            clonedDiv.style.overflowY = 'visible';

            // Remove pseudo-element placeholder
            clonedDiv.style.setProperty('::before', 'none');

            // Ensure all child elements inherit styles
            const allElements = clonedDiv.querySelectorAll('*');
            allElements.forEach(element => {
               element.style.color = textColor;
               element.style.fontSize = fontSize;
               element.style.fontWeight = element.style.fontWeight || fontWeight;
               element.style.fontFamily = '"Red Hat Display", sans-serif';
               element.style.letterSpacing = '0.5px';
               element.style.lineHeight = '1.5';
            });

            wrapper.appendChild(clonedDiv);

            // Add watermark
            const watermark = document.createElement('div');
            watermark.className = 'watermark';
            const link = document.createElement('a');
            link.href = 'https://blackswan19.github.io/bscrop/formbs';
            link.textContent = 'Made in BsBookpad';
            watermark.appendChild(link);

            const watermarkColor = getContrastColor(backgroundColor);
            watermark.style.color = watermarkColor;
            link.style.color = watermarkColor;
            wrapper.appendChild(watermark);

            // Append wrapper to body to measure dimensions
            document.body.appendChild(wrapper);

            // Calculate dimensions
            const extraPadding = 40;
            const scrollHeight = clonedDiv.scrollHeight;
            const scrollWidth = Math.max(clonedDiv.scrollWidth, 300);
            const textWidth = scrollWidth + extraPadding;
            const textHeight = scrollHeight + extraPadding;

            wrapper.style.width = `${textWidth}px`;
            wrapper.style.height = `${textHeight}px`;

            // Use html2canvas to capture the wrapper
            html2canvas(wrapper, {
               width: textWidth,
               height: textHeight,
               scale: 2,
               backgroundColor: backgroundColor,
               scrollX: 0,
               scrollY: 0,
               windowWidth: textWidth,
               windowHeight: textHeight,
               logging: true
            }).then(canvas => {
               const link = document.createElement('a');
               link.download = 'bs_bookpad.png';
               link.href = canvas.toDataURL('image/png');
               link.click();
               document.body.removeChild(wrapper);
               displayMessage("Downloaded as Image!");
            }).catch(err => {
               console.error('Error generating image:', err);
               document.body.removeChild(wrapper);
               displayMessage("Error downloading image!");
            });
         }

         function downloadAsPDF() {
            if (!editableDiv.innerText.trim()) {
               displayMessage("Nothing to download..!");
               return;
            }

            const backgroundColor = document.getElementById('imageBackgroundColor').value;
            const textColor = document.getElementById('imageTextColor').value;
            const fontSize = parseInt(editableDiv.style.fontSize.replace('px', '')) || 16;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const bgHex = backgroundColor.replace('#', '');
            const bgR = parseInt(bgHex.substring(0, 2), 16);
            const bgG = parseInt(bgHex.substring(2, 4), 16);
            const bgB = parseInt(bgHex.substring(4, 6), 16);

            const textHex = textColor.replace('#', '');
            const textR = parseInt(textHex.substring(0, 2), 16);
            const textG = parseInt(textHex.substring(2, 4), 16);
            const textB = parseInt(textHex.substring(4, 6), 16);

            const watermarkColor = getContrastColor(backgroundColor);
            const watermarkR = parseInt(watermarkColor.substring(1, 3), 16);
            const watermarkG = parseInt(watermarkColor.substring(3, 5), 16);
            const watermarkB = parseInt(watermarkColor.substring(5, 7), 16);

            function addWatermark() {
               doc.setFontSize(8);
               doc.setTextColor(watermarkR, watermarkG, watermarkB);
               const watermarkText = 'Made in BsBookpad';
               const watermarkX = 10;
               const watermarkY = 10;
               doc.text(watermarkText, watermarkX, watermarkY);
               const textWidth = doc.getTextWidth(watermarkText);
               doc.link(watermarkX, watermarkY - 3, textWidth, 4, {
                  url: 'https://blackswan19.github.io/bscrop/formbs'
               });
               doc.setFontSize(fontSize);
            }

            let cursorY = 20;
            let pageCount = 1;
            doc.setFillColor(bgR, bgG, bgB);
            doc.rect(0, 0, 210, 297, 'F');
            doc.setTextColor(textR, textG, textB);
            addWatermark();

            const maxWidth = 190;
            const lineHeight = fontSize * 0.5;

            function processNodes(nodes) {
               const textLines = [];
               nodes.forEach(node => {
                  if (node.nodeType === Node.TEXT_NODE) {
                     const text = node.textContent;
                     if (text.trim()) {
                        textLines.push({ text: text, bold: false });
                     }
                  } else if (node.nodeName === 'SPAN') {
                     const fontWeight = parseInt(node.style.fontWeight) || 400;
                     const lines = node.textContent.split('\n');
                     lines.forEach(line => {
                        if (line.trim()) {
                           textLines.push({ text: line, bold: fontWeight >= 700 });
                        } else {
                           textLines.push({ text: '', bold: false });
                        }
                     });
                  } else if (node.nodeName === 'BR') {
                     textLines.push({ text: '', bold: false });
                  } else if (node.childNodes.length > 0) {
                     const childLines = processNodes(node.childNodes);
                     textLines.push(...childLines);
                  }
               });
               return textLines;
            }

            const textLines = processNodes(editableDiv.childNodes);

            textLines.forEach(lineObj => {
               if (lineObj.text === '') {
                  cursorY += lineHeight;
                  return;
               }
               const lines = doc.splitTextToSize(lineObj.text, maxWidth);
               lines.forEach(line => {
                  if (cursorY > 280) {
                     doc.addPage();
                     pageCount++;
                     doc.setFillColor(bgR, bgG, bgB);
                     doc.rect(0, 0, 210, 297, 'F');
                     doc.setTextColor(textR, textG, textB);
                     addWatermark();
                  }
                  doc.setFont("helvetica", lineObj.bold ? "bold" : "normal");
                  doc.setFontSize(fontSize);
                  doc.text(line, 10, cursorY);
                  cursorY += lineHeight;
               });
            });

            doc.save('bs_bookpad.pdf');
            displayMessage("Downloaded as PDF!");
         }

         function displayMessage(message) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
    
            setTimeout(() => {
               messageDiv.textContent = '';
            }, 3000);
         }

         document.addEventListener("DOMContentLoaded", () => {
            const customMenu = document.querySelector(".custom-menu");
            document.addEventListener("contextmenu", (event) => {
               event.preventDefault();
               if (customMenu) {
                  customMenu.style.display = "block";
                  customMenu.style.top = `${event.pageY}px`;
                  customMenu.style.left = `${event.pageX}px`;
               }
            });
            document.addEventListener("click", () => {
               if (customMenu) customMenu.style.display = "none";
            });
         });
      </script>
   </body>
</html>
