<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <title>BsBlackrooms</title> <link rel="icon" type="image/x-icon" href="https://i.ibb.co/bND6ZhX/logo.png"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"> <style> @import url('https://fonts.googleapis.com/css2?family=Red+Hat+Display:wght@400;500;700&display=swap'); * { margin:0; padding:0; box-sizing:border-box; font-family:'Red Hat Display',sans-serif;scrollbar-width: thin;scrollbar-color: gray black; } body { background:#000; color:#fff; height:100vh; overflow:hidden; user-select:none; } #landing { display: flex; flex-direction: column; align-items: center; height: 100vh; text-align: center; gap: 30px; margin-top: 50px; } #landing h1 { font-size: 35px; color: #004cff; } #roomName { padding: 12px 35px; width: 321px; border: none; border-radius: 163px; background: #1a1a1a; color: #fff; font-size: 18px; outline: none; } #roomName:focus {background:#ffffff3e; } .btn { padding: 13px 25px; background: #0015ffa8; color: white; border: none; border-radius: 51px; cursor: pointer; font-size: 16px; transition: .3s; display: inline-flex; align-items: center; gap: 10px; } .btn:hover { background:#0051ff;} #blackboard { display:none; width:100vw; height:100vh; background:#0a0a0a; position:relative; } #controls { position:fixed; top:20px; left:20px; z-index:1000; display:flex; gap:12px; } #controls button { padding: 8px 14px; background: rgb(255 255 255 / 40%); backdrop-filter: blur(12px); display: flex; justify-content: center; align-items: center; gap: 3px; font-size: 16px; color: white; border: none; border-radius: 100px; } #controls button:hover { background:#004cff;} #stop-start-btn.active { background:#d32f2f !important; } #trash-bin { position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: #ff0000; border-radius:13px; display: grid; place-items: center; font-size: 20px; box-shadow: 0 8px 30px rgba(211, 47, 47, 0.7); z-index: 1000; cursor: pointer; } .text-box { position: absolute; min-width: 260px; padding: 10px 10px 10px 20px; background: rgba(50, 50, 50, 0.95); border-radius: 106px; cursor: grab; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6); display: flex; gap: 16px; align-items: flex-start; will-change: transform; display: flex; align-items: center; } .text-box:active { cursor:grabbing; } .text-box.dragging { z-index:9999; opacity:0.9; transform:scale(1.05); } .text-content { flex:1; outline:none; white-space:pre-wrap; word-break:break-word; min-height:32px; line-height:1.6; font-size:18px; } .menu-btn { width: 44px; height: 44px; border-radius: 50%; background: #00000087; display: grid; place-items: center; font-size: 1.3rem; cursor: pointer; transition: .2s; color: #ffffffc2; border: solid 1.5px #ffffffb5; } .menu-btn:hover{ color: rgb(255, 255, 255);background: #000000; } svg{ fill: white; height: 20px; width: 25px; } .text-menu { position: absolute; right: 5px; top: 69px; background: #46464600; border-radius: 55px; padding: 10px 0px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8); display: none; z-index: 10000; border: solid 1.5px #ffffff3d; backdrop-filter: blur(10px); width: 55px; } .text-menu button { width: 100%; background: none; border: none; color: #ffffff44; font-size: 14px; cursor: pointer; text-align: center; transition: .2s; padding: 10px; } .text-menu button:hover {color: #ffffff;} .popup { position:fixed; top:20px; right:20px; background:#001dd8; padding:9px 13px; border-radius:102px; box-shadow:0 10px 30px rgba(0,0,0,0.8); opacity:0; transform:translateY(-20px); transition:.4s; z-index:2000; } .popup.show { opacity:1; transform:translateY(0); } .room-item { background: #1f1f1f; padding: 10px 10px 10px 30px; border-radius: 43px; margin: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: .3s; min-width: 265px; color: #ffffff9e; }.room-item span { width: 135px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: left; } .room-item:hover { background:#ffffff3e;} .delete-room-btn { background: red; display: grid; place-items: center; font-size: 15px; font-weight: bold; color: white; padding: 5px 10px; border-radius: 30px; border: none; } </style> </head> <body> <div id="landing"> <h1>BsBlackrooms</h1> <div> <input type="text" id="roomName" placeholder="Enter room name..." autocomplete="off"> <button class="btn" onclick="createRoom()">Create Room</button> </div> <div id="room-list"></div> </div> <div id="blackboard"> <div id="controls"> <button onclick="backToLanding()"><i class="fa-solid fa-chevron-left"></i> Back</button> <button onclick="saveContent()"><?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24"> <path d="m17,24h-8C4.037,24,0,19.962,0,15V7c0-.552.447-1,1-1s1,.448,1,1v8c0,3.86,3.141,7,7,7h8c.553,0,1,.448,1,1s-.447,1-1,1Zm0-24h-6v5h6V0Zm7,6.267v8.733c0,2.761-2.239,5-5,5h-10c-2.761,0-5-2.239-5-5V5C4,2.243,6.243,0,9,0v5c0,1.105.895,2,2,2h6c1.105,0,2-.895,2-2V.277c.33.15.637.352.894.611l3.236,3.265c.557.562.87,1.322.87,2.114Zm-6,7.233c0-1.933-1.567-3.5-3.5-3.5s-3.5,1.567-3.5,3.5,1.567,3.5,3.5,3.5,3.5-1.567,3.5-3.5Zm-2,0c0,.828-.672,1.5-1.5,1.5s-1.5-.672-1.5-1.5.672-1.5,1.5-1.5,1.5.672,1.5,1.5Z"/> </svg> Save</button> <button id="stop-start-btn" onclick="toggleTextCreation()"><?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="m12,0C5.383,0,0,5.383,0,12s5.383,12,12,12,12-5.383,12-12S18.617,0,12,0Zm0,21c-4.962,0-9-4.038-9-9S7.038,3,12,3s9,4.038,9,9-4.038,9-9,9Zm4-11v4c0,1.105-.895,2-2,2h-4c-1.105,0-2-.895-2-2v-4c0-1.105.895-2,2-2h4c1.105,0,2,.895,2,2Z"/></svg> Stop</button> </div> <div id="trash-bin"><i class="fas fa-trash-can"></i></div> </div>
<script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    const $ = id => document.getElementById(id);
    const blackboard = $('blackboard');
    const landing = $('landing');
    const roomList = $('room-list');
    const stopStartBtn = $('stop-start-btn');
    let currentRoom = null;
    let isTextCreationEnabled = true;

    window.onload = () => loadRoomList();

    function showPopup(msg) {
        const p = document.createElement('div');
        p.className = 'popup';
        p.textContent = msg;
        document.body.appendChild(p);
        setTimeout(() => p.classList.add('show'), 10);
        setTimeout(() => {
            p.classList.remove('show');
            setTimeout(() => p.remove(), 500);
        }, 1800);
    }

    function createTextBox(x, y, saved = null) {
        const box = document.createElement('div');
        box.className = 'text-box';
        box.style.left = x + 'px';
        box.style.top = y + 'px';

        const content = document.createElement('div');
        content.className = 'text-content';
        content.contentEditable = true;
        content.innerText = saved?.text || 'Click to type...';

        const menuBtn = document.createElement('div');
        menuBtn.className = 'menu-btn';
        menuBtn.innerHTML = '<i class="fa-solid fa-ellipsis-vertical"></i>';

        // Default or saved values
        const textColor = saved?.color || '#ffffff';
        const bgColor = saved?.bg || '#323232';
        const fontSize = saved?.size || 18;
        const isBold = saved?.bold || false;

        // Apply styles to BOTH box and content (critical!)
        box.style.color = textColor;
        box.style.fontSize = fontSize + 'px';
        box.style.fontWeight = isBold ? 'bold' : 'normal';
        box.style.background = `rgba(${hexToRgb(bgColor)}, 0.95)`;

        content.style.color = textColor;
        content.style.fontSize = fontSize + 'px';
        content.style.fontWeight = isBold ? 'bold' : 'normal';

        // Store in dataset for saving
        box.dataset.textColor = textColor;
        box.dataset.bgColor = bgColor;
        box.dataset.fontSize = fontSize;
        box.dataset.bold = isBold;

        box.dataset.baseX = x;
        box.dataset.baseY = y;

        box.append(content, menuBtn);
        blackboard.appendChild(box);

        makeDraggable(box);
        createIconMenu(box, content, menuBtn);

        setTimeout(() => content.focus(), 100);
    }

    function hexToRgb(hex) {
        hex = hex.replace('#', '');
        if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
        const n = parseInt(hex, 16);
        return `${n >> 16 & 255},${n >> 8 & 255},${n & 255}`;
    }

    function createIconMenu(box, content, btn) {
        const menu = document.createElement('div');
        menu.className = 'text-menu';

        const items = [
            { icon: 'edit', title: 'Edit', fn: () => editText(box, content) },
            { icon: 'bold', title: 'Bold', fn: () => toggleBold(box, content) },
            { icon: 'palette', title: 'Text Color', fn: () => pickColor(box, content, 'text') },
            { icon: 'fill-drip', title: 'Background', fn: () => pickColor(box, content, 'bg') },
            { icon: 'text-height', title: 'Font Size', fn: () => changeFontSize(box, content) },
        ];

        items.forEach(i => {
            const b = document.createElement('button');
            b.innerHTML = `<i class="fas fa-${i.icon}"></i>`;
            b.title = i.title;
            b.onclick = e => {
                e.stopPropagation();
                i.fn();
                menu.style.display = 'none';
            };
            menu.appendChild(b);
        });

        box.appendChild(menu);

        btn.onclick = e => {
            e.stopPropagation();
            const open = menu.style.display === 'block';
            document.querySelectorAll('.text-menu').forEach(m => m.style.display = 'none');
            menu.style.display = open ? 'none' : 'block';
        };
    }

    function toggleBold(box, content) {
        const newWeight = box.style.fontWeight === 'bold' ? 'normal' : 'bold';
        box.style.fontWeight = newWeight;
        content.style.fontWeight = newWeight;
        box.dataset.bold = newWeight === 'bold';
    }

    function pickColor(box, content, type) {
        const input = document.createElement('input');
        input.type = 'color';
        input.value = type === 'text' ? box.dataset.textColor : box.dataset.bgColor;

        input.onchange = () => {
            if (type === 'text') {
                box.style.color = input.value;
                content.style.color = input.value;
                box.dataset.textColor = input.value;
            } else {
                box.style.background = `rgba(${hexToRgb(input.value)}, 0.95)`;
                box.dataset.bgColor = input.value;
            }
        };
        input.click();
    }

    function changeFontSize(box, content) {
        const current = box.dataset.fontSize || '18';
        const size = prompt('Font size (8â€“100px)', current);
        if (size && !isNaN(size)) {
            const s = Math.max(8, Math.min(100, parseInt(size)));
            box.style.fontSize = s + 'px';
            content.style.fontSize = s + 'px';           // THIS IS THE KEY FIX
            box.dataset.fontSize = s;
        }
    }

    function editText(box, content) {
        const ta = document.createElement('textarea');
        ta.value = content.innerText.trim() === 'Click to type...' ? '' : content.innerText;
        ta.style.cssText = `
            position:absolute; top:0; left:0; width:100%; height:100%; padding:18px;
            background:rgba(0,0,0,0.85); color:${box.style.color};
            font-size:${box.style.fontSize}; font-weight:${box.style.fontWeight};
            border:3px solid #004cff; border-radius:18px; resize:none; outline:none;
            box-sizing:border-box;`;
        content.style.opacity = '0';
        box.appendChild(ta);
        ta.focus();

        const save = () => {
            content.innerText = ta.value || 'New note';
            content.style.opacity = '1';
            ta.remove();
        };
        ta.onblur = save;
        ta.onkeydown = e => {
            if (e.ctrlKey && e.key === 'Enter') save();
            if (e.key === 'Escape') { content.style.opacity = '1'; ta.remove(); }
        };
    }

    function makeDraggable(el) {
        let startX, startY, baseX, baseY;

        const down = (e) => {
            if (e.target.closest('.menu-btn') || e.target.closest('.text-menu') || e.target.tagName === 'TEXTAREA') return;

            e.preventDefault();
            el.classList.add('dragging');

            const rect = el.getBoundingClientRect();
            baseX = rect.left;
            baseY = rect.top;
            startX = e.clientX || e.touches?.[0].clientX;
            startY = e.clientY || e.touches?.[0].clientY;

            document.addEventListener('pointermove', move);
            document.addEventListener('pointerup', up);
            document.addEventListener('pointercancel', up);
        };

        const move = (e) => {
            const x = e.clientX || e.touches?.[0].clientX;
            const y = e.clientY || e.touches?.[0].clientY;
            const dx = x - startX;
            const dy = y - startY;

            el.style.transform = `translate(${dx}px, ${dy}px)`;
            el.style.background = isOverTrash(el) ? 'rgba(211,47,47,0.9)' : `rgba(${hexToRgb(el.dataset.bgColor)},0.95)`;
        };

        const up = (e) => {
            if (!el.classList.contains('dragging')) return;
            el.classList.remove('dragging');

            const x = e.clientX || e.changedTouches?.[0].clientX || startX;
            const y = e.clientY || e.changedTouches?.[0].clientY || startY;
            const dx = x - startX;
            const dy = y - startY;

            // Update base position
            el.dataset.baseX = (parseFloat(el.dataset.baseX) + dx) + 'px';
            el.dataset.baseY = (parseFloat(el.dataset.baseY) + dy) + 'px';
            el.style.left = el.dataset.baseX;
            el.style.top = el.dataset.baseY;
            el.style.transform = 'translate(0px,0px)';

            document.removeEventListener('pointermove', move);
            document.removeEventListener('pointerup', up);
            document.removeEventListener('pointercancel', up);

            if (isOverTrash(el)) {
                el.remove();
                showPopup('Deleted');
            } else {
                el.style.background = `rgba(${hexToRgb(el.dataset.bgColor)},0.95)`;
            }
        };

        el.addEventListener('pointerdown', down);
    }

    function isOverTrash(el) {
        const trash = $('trash-bin');
        if (!trash) return false;
        const t = trash.getBoundingClientRect();
        const r = el.getBoundingClientRect();
        return !(r.right < t.left || r.left > t.right || r.bottom < t.top || r.top > t.bottom);
    }

    // Room functions
    function createRoom() {
        const name = $('roomName').value.trim();
        if (!name) return showPopup('Enter room name!');
        let rooms = JSON.parse(localStorage.getItem('rooms') || '[]');
        if (rooms.includes(name)) return showPopup('Room already exists!');
        rooms.push(name);
        localStorage.setItem('rooms', JSON.stringify(rooms));
        enterRoom(name);
        $('roomName').value = '';
    }

    function enterRoom(name) {
        saveContent();
        currentRoom = name;
        landing.style.display = 'none';
        blackboard.style.display = 'block';
        clearBlackboard();
        loadContent(name);
        isTextCreationEnabled = true;
        updateStopStartButton();
    }

    function loadRoomList() {
        const rooms = JSON.parse(localStorage.getItem('rooms') || '[]');
        roomList.innerHTML = '';
        rooms.forEach(r => {
            const div = document.createElement('div');
            div.className = 'room-item';
            div.innerHTML = `<span onclick="enterRoom('${r}')">${r}</span>
                <button class="delete-room-btn" onclick="deleteRoom('${r}',event)">Delete</button>`;
            roomList.appendChild(div);
        });
    }

    function deleteRoom(name, e) {
        e.stopPropagation();
        if (!confirm(`Delete room "${name}"?`)) return;
        let rooms = JSON.parse(localStorage.getItem('rooms') || '[]');
        rooms = rooms.filter(x => x !== name);
        localStorage.setItem('rooms', JSON.stringify(rooms));
        localStorage.removeItem(`content_${name}`);
        loadRoomList();
        if (currentRoom === name) backToLanding();
        showPopup('Room deleted');
    }

    blackboard.onclick = e => {
        if (!isTextCreationEnabled || e.target !== blackboard) return;
        createTextBox(e.clientX - 130, e.clientY - 70);
    };

    function toggleTextCreation() {
        isTextCreationEnabled = !isTextCreationEnabled;
        updateStopStartButton();
        showPopup(isTextCreationEnabled ? 'Click to add notes' : 'Creation paused');
    }

    function updateStopStartButton() {
        stopStartBtn.innerHTML = isTextCreationEnabled
            ? `<svg viewBox="0 0 24 24" width="20" height="20"><path d="M12,0A12,12 0 1,0 24,12 12,12 0 0,0 12,0Zm0,21A9,9 0 1,1 21,12 9,9 0 0,1 12,21Zm4-11v4a2,2 0 0,1 -2,2h-4a2,2 0 0,1 -2,-2v-4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2Z"/></svg> Stop`
            : '<i class="fas fa-plus"></i> Start';
        stopStartBtn.classList.toggle('active', !isTextCreationEnabled);
    }

    function saveContent() {
        if (!currentRoom) return;
        const data = [];
        document.querySelectorAll('.text-box').forEach(box => {
            const content = box.querySelector('.text-content');
            data.push({
                text: content.innerText,
                x: parseFloat(box.dataset.baseX),
                y: parseFloat(box.dataset.baseY),
                color: box.dataset.textColor,
                bg: box.dataset.bgColor,
                size: parseInt(box.dataset.fontSize || 18),
                bold: box.dataset.bold === 'true'
            });
        });
        localStorage.setItem(`content_${currentRoom}`, JSON.stringify(data));
        showPopup('Saved!');
    }

    function loadContent(name) {
        const raw = localStorage.getItem(`content_${name}`);
        if (!raw) return;
        JSON.parse(raw).forEach(item => createTextBox(item.x, item.y, item));
    }

    function clearBlackboard() {
        blackboard.querySelectorAll('.text-box').forEach(b => b.remove());
    }

    function backToLanding() {
        saveContent();
        blackboard.style.display = 'none';
        landing.style.display = 'flex';
        currentRoom = null;
        clearBlackboard();
        loadRoomList();
    }
</script>
</body>
</html>
